{% extends "base.html" %}

{% block content %}
<div class="row mb-4">
    <h1><i class="fas fa-leaf"></i> Crop Details: {{ crop.crop_type }}</h1>
</div>

<div class="row">
    <div class="col-md-8">
        <div class="card mb-3">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0">Crop Information</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <p><strong>Crop Type:</strong> {{ crop.crop_type }}</p>
                        <p><strong>Variety:</strong> {{ crop.variety or '-' }}</p>
                        <p><strong>Field:</strong> {{ crop.field.name }}</p>
                        <p><strong>Status:</strong> 
                            {% if crop.status == 'Growing' %}
                                <span class="badge bg-success">{{ crop.status }}</span>
                            {% elif crop.status == 'Harvested' %}
                                <span class="badge bg-primary">{{ crop.status }}</span>
                            {% else %}
                                <span class="badge bg-danger">{{ crop.status }}</span>
                            {% endif %}
                        </p>
                    </div>
                    <div class="col-md-6">
                        <p><strong>Seeding Date:</strong> {{ crop.seeding_date.strftime('%Y-%m-%d') }}</p>
                        <p><strong>Expected Harvest:</strong> {{ crop.expected_harvest_date.strftime('%Y-%m-%d') if crop.expected_harvest_date else '-' }}</p>
                        <p><strong>Actual Harvest:</strong> {{ crop.actual_harvest_date.strftime('%Y-%m-%d') if crop.actual_harvest_date else '-' }}</p>
                        <p><strong>Quantity Seeded:</strong> {{ crop.quantity_seeded }} kg</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="card mb-3">
            <div class="card-header bg-success text-white">
                <h5 class="mb-0">Financial Summary</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-4">
                        <h6>Yield</h6>
                        <p class="display-6">{{ crop.actual_yield or crop.expected_yield or '0' }}</p>
                        <small class="text-muted">kg</small>
                    </div>
                    <div class="col-md-4">
                        <h6>Revenue</h6>
                        <p class="display-6 text-success">₹{{ revenue }}</p>
                    </div>
                    <div class="col-md-4">
                        <h6>Total Cost</h6>
                        <p class="display-6 text-danger">₹{{ total_cost + total_labour_cost }}</p>
                    </div>
                </div>
                <hr>
                <div class="row">
                    <div class="col-md-6">
                        <p><strong>Material Cost:</strong> ₹{{ total_cost }}</p>
                    </div>
                    <div class="col-md-6">
                        <p><strong>Labour Cost:</strong> ₹{{ total_labour_cost }}</p>
                    </div>
                </div>
                <div class="row mt-3">
                    <div class="col-md-12">
                        <h6 class="text-info display-6">Gross Profit: ₹{{ gross_profit }}</h6>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="col-md-4">
        <div class="card mb-3">
            <div class="card-body">
                <a href="/crops/{{ crop.id }}/edit" class="btn btn-warning w-100 mb-2"><i class="fas fa-edit"></i> Edit Crop</a>
                <a href="/labour/record/add?crop_id={{ crop.id }}" class="btn btn-info w-100 mb-2"><i class="fas fa-plus"></i> Add Labour</a>
                <a href="/costs/add?crop_id={{ crop.id }}" class="btn btn-primary w-100 mb-2"><i class="fas fa-plus"></i> Add Cost</a>
                <a href="/crops/{{ crop.id }}/delete" class="btn btn-danger w-100" onclick="return confirm('Are you sure?')"><i class="fas fa-trash"></i> Delete</a>
            </div>
        </div>

        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">Notes</h5>
            </div>
            <div class="card-body">
                <p>{{ crop.notes or 'No notes' }}</p>
            </div>
        </div>
    </div>
</div>

<div class="row mt-4">
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0"><i class="fas fa-users"></i> Labour Records ({{ labour_records|length }})</h5>
            </div>
            <div class="card-body">
                {% if labour_records %}
                    <div class="table-responsive">
                        <table class="table table-sm">
                            <thead>
                                <tr>
                                    <th>Worker</th>
                                    <th>Type</th>
                                    <th>Hours</th>
                                    <th>Date</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for record in labour_records %}
                                <tr>
                                    <td>{{ record.labour.name }}</td>
                                    <td>{{ record.work_type }}</td>
                                    <td>{{ record.hours_worked }}</td>
                                    <td>{{ record.work_date.strftime('%Y-%m-%d') }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                {% else %}
                    <p class="text-muted">No labour records yet.</p>
                {% endif %}
            </div>
        </div>
    </div>

    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0"><i class="fas fa-money-bill"></i> Cost Records ({{ cost_records|length }})</h5>
            </div>
            <div class="card-body">
                {% if cost_records %}
                    <div class="table-responsive">
                        <table class="table table-sm">
                            <thead>
                                <tr>
                                    <th>Category</th>
                                    <th>Amount</th>
                                    <th>Date</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for record in cost_records %}
                                <tr>
                                    <td>{{ record.category }}</td>
                                    <td>₹{{ record.amount }}</td>
                                    <td>{{ record.transaction_date.strftime('%Y-%m-%d') }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                {% else %}
                    <p class="text-muted">No cost records yet.</p>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<div class="row mt-2">
    <div class="col-md-12">
        <a href="/crops/" class="btn btn-secondary"><i class="fas fa-arrow-left"></i> Back to Crops</a>
    </div>
</div>
{% endblock %}
